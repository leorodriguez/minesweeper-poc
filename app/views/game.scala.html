@(game: GameResponse, tokenName: String, tokenValue: String)(implicit assetsFinder: AssetsFinder)
@defining(0 until game.board.nRows) { rowsRange =>
@defining(0 until game.board.nCols) { colsRange =>


<html>
<head>
    <script src="@assetsFinder.path("javascripts/jquery-3.5.1.js")" type="text/javascript"></script>
    <script src="@assetsFinder.path("javascripts/image-scale.js")" type="text/javascript"></script>
    <script>
    let endpoint = 'http://localhost:9000/api/games/' + '@game.id';

    function revealNewBoard(i, j) {
        let data = {"row": i, "col": j};
        $.ajax({
            url: endpoint + "/_reveal",
            type: 'PUT',
            headers: {
                'Csrf-Token': '@tokenValue'
            },
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function( result ) {
                updateBoard(result)
            }
        });
    }

    function markNewBoard(i, j) {
        let data = {"row": i, "col": j};
        $.ajax({
            url: endpoint + "/_mark",
            type: 'PUT',
            headers: {
                'Csrf-Token': '@tokenValue'
            },
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function( result ) {
                updateBoard(result)
            }
        });
    }

    function initBoard() {
        $.ajax({
            url: endpoint,
            type: 'GET',
            headers: {
                'Csrf-Token': '@tokenValue'
            },
            contentType: "application/json",
            success: function( result ) {
                updateBoard(result)
            }
        });
    }

    function updateBoard(result) {
        console.log(result);
        let cells = result.board.cells;
        var i = 0;
        for (i = 0; i < cells.length; i++) {
            let cell_id = "item-" + cells[i].row + "-" + cells[i].col;
            $('#' + cell_id).html(imageTag(cells[i]));
        }
        $("img.scale").imageScale();
        if (result.board.hasWinner) {
            $('#msg').html("<strong>You WON</strong");
            unbindCells();
        } else if (result.board.hasLoser) {
            $('#msg').html("<strong>Game Over</strong");
            unbindCells();
            return;
        }
    }

    function imageTag(cell) {
        let name = imageName(cell);
        return `<img class="scale" data-scale="best-fit-down" data-align="center" src='@assetsFinder.path("images/${name}")'>`;
    }

    function imageName(cell) {
        if ('mark' in cell) {
            return "" + cell.mark + ".svg";
        } else if (cell.hidden) {
            return "hidden.svg";
        } else if (cell.hasMine) {
            return "mine.svg";
        } else if (cell.number == 0) {
            return "safe.svg";
        } else {
            return "" + cell.number + ".svg";
        }
    }

    function unbindCells() {
        @for(i <- rowsRange) {
            @for(j <- colsRange) {
                $("#item-@i-@j").off();
           }
        }
    }

    $( document ).ready(function() {
        @for(i <- rowsRange) {
            @for(j <- colsRange) {
                $( "#item-@i-@j" ).click(function() {
                    revealNewBoard(@i, @j);
                });
                $( "#item-@i-@j" ).bind("contextmenu", function(e) {
                    e.preventDefault();
                    markNewBoard(@i, @j);
                    return false;
                });
            }
        }
        initBoard();
    });
    </script>
<style>
.grid-container {
  display: grid;
  grid-template-columns: repeat(@game.board.nCols, 1fr);
  grid-template-rows: repeat(@game.board.nRows, 60px);
  grid-gap: 10px;
  background-color: #2196F3;
  padding: 10px;
}

.grid-container > div {
  background-color: rgba(255, 255, 255, 0.8);
  text-align: center;
  padding: 20px 0;
  font-size: 30px;
}
</style>



</head>
<body>

<p id="msg">Clear the land and flag all the mines!</p>

<div class="grid-container">
    @for(i <- rowsRange) {
        @for(j <- colsRange) {
            <div class="item1" id="item-@i-@j">@i, @j</div>
        }
    }
</div>


</body>
</html>


}}
